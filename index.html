<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ù†ØµØ© Ø·Ù„Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù…</title>

  <style>
    body{font-family:Arial;background:#F7F4EF;direction:rtl;margin:0}
    header{background:#F7F4EF;color:#000;padding:50px 20px;text-align:center}
    header img{width:150px;height:auto;display:block;margin:0 auto 10px}
    .container{width:90%;max-width:1100px;margin:auto;padding:20px}
    .rest{margin:30px 0}
    .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
    .product{background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);padding:15px;text-align:center}
    .product img{width:100%;height:150px;object-fit:cover;border-radius:10px}
    .product button{background:#ff5722;color:#fff;border:none;padding:8px;width:100%;border-radius:8px;cursor:pointer}
    .product button:active{transform:scale(.99)}

    .cart{background:#fff;padding:20px;border-radius:12px;margin-top:30px;box-shadow:0 4px 10px rgba(0,0,0,.08)}
    .cart-item{display:grid;grid-template-columns:1fr 90px 90px 40px;gap:10px;align-items:center;border-bottom:1px solid #ddd;padding:10px 0}
    .cart-item .qty{width:100%;padding:6px}
    .cart-item button{background:red;color:white;border:none;padding:6px 0;border-radius:6px;cursor:pointer}

    .total{font-size:20px;color:#ff5722;text-align:center;margin:10px 0}
    input,textarea{width:100%;padding:10px;margin-top:8px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box}
    textarea{min-height:90px;resize:vertical}

    .whatsapp{background:#25d366;color:white;font-size:18px;border:none;padding:12px;width:100%;border-radius:8px;cursor:pointer;margin-top:10px}
    .whatsapp:active{transform:scale(.99)}

    .location{
      background:#2196f3;color:#fff;font-size:16px;border:none;
      padding:10px;width:100%;border-radius:8px;cursor:pointer;margin:10px 0 0 0
    }

    .size-btns{display:flex;gap:6px;justify-content:center;margin:6px 0;flex-wrap:wrap}
    .size-btns button{border:1px solid #ff5722;background:#fff;padding:6px 10px;border-radius:6px;cursor:pointer;width:auto;color:#ff5722}
    .size-btns button.active{background:#ff5722;color:#fff}

    .qty-box{display:flex;justify-content:center;gap:10px;margin:8px 0}
    .qty-box button{width:32px;height:32px;border-radius:50%;border:none;background:#ff5722;color:#fff;font-size:18px;cursor:pointer}
    .qty-box span{font-size:18px;width:30px;text-align:center;display:inline-block}

    small{display:block;margin-top:6px}
  </style>
</head>

<body>
  <header>
    <img src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Photoroom-20260117_132534545.png" alt="Logo">
    <p>Ø§Ø®ØªØ± Ù…Ø·Ø¹Ù…Ùƒ ÙˆØ§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</p>
  </header>

  <div class="container">

    <!-- Ù…Ø·Ø¹Ù… 1 -->
    <div class="rest">
      <h2>ğŸ• Ù…Ø·Ø¹Ù… Ø§Ù„Ø¥ÙŠØ·Ø§Ù„ÙŠ</h2>
      <div class="products">
        <div class="product" data-name="Ø¨ÙŠØªØ²Ø§" data-cat="italian" data-price="40">
          <img src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Gemini_Generated_Image_xj7e77xj7e77xj7e.png" alt="Ø¨ÙŠØªØ²Ø§">
          <h3>Ø¨ÙŠØªØ²Ø§</h3>
          <p class="price">40 Ø¯Ø±Ù‡Ù…</p>
          <div class="qty-box">
            <button type="button" onclick="changeQty(this,-1)">âˆ’</button>
            <span>1</span>
            <button type="button" onclick="changeQty(this,1)">+</button>
          </div>
          <button type="button" onclick="addToCart(this,'Ø§Ù„Ø¥ÙŠØ·Ø§Ù„ÙŠ','Ø¨ÙŠØªØ²Ø§',40)">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        </div>

        <div class="product" data-name="Ø¨Ø§Ø³ØªØ§" data-cat="italian" data-price="35">
          <img src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Gemini_Generated_Image_nge012nge012nge0.png" alt="Ø¨Ø§Ø³ØªØ§">
          <h3>Ø¨Ø§Ø³ØªØ§</h3>
          <p class="price">35 Ø¯Ø±Ù‡Ù…</p>
          <div class="qty-box">
            <button type="button" onclick="changeQty(this,-1)">âˆ’</button>
            <span>1</span>
            <button type="button" onclick="changeQty(this,1)">+</button>
          </div>
          <button type="button" onclick="addToCart(this,'Ø§Ù„Ø¥ÙŠØ·Ø§Ù„ÙŠ','Ø¨Ø§Ø³ØªØ§',35)">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        </div>
      </div>
    </div>

    <!-- Ù…Ø·Ø¹Ù… 2 -->
    <div class="rest">
      <h2>ğŸ” Ù…Ø·Ø¹Ù… Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ</h2>
      <div class="products">
        <div class="product" data-name="Ù‡Ù…Ø¨Ø±ØºØ±" data-cat="american" data-price="30">
          <img src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Gemini_Generated_Image_fvtl2yfvtl2yfvtl.png" alt="Ù‡Ù…Ø¨Ø±ØºØ±">
          <h3>Ù‡Ù…Ø¨Ø±ØºØ±</h3>
          <p class="price">30 Ø¯Ø±Ù‡Ù…</p>
          <div class="qty-box">
            <button type="button" onclick="changeQty(this,-1)">âˆ’</button>
            <span>1</span>
            <button type="button" onclick="changeQty(this,1)">+</button>
          </div>
          <button type="button" onclick="addToCart(this,'Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ','Ù‡Ù…Ø¨Ø±ØºØ±',30)">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        </div>

        <div class="product" data-name="Ø¨Ø·Ø§Ø·Ø³" data-cat="american" data-price="15">
          <img src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Gemini_Generated_Image_vxzgslvxzgslvxzg.png" alt="Ø¨Ø·Ø§Ø·Ø³">
          <h3>Ø¨Ø·Ø§Ø·Ø³</h3>
          <p class="price">15 Ø¯Ø±Ù‡Ù…</p>
          <div class="qty-box">
            <button type="button" onclick="changeQty(this,-1)">âˆ’</button>
            <span>1</span>
            <button type="button" onclick="changeQty(this,1)">+</button>
          </div>
          <button type="button" onclick="addToCart(this,'Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ','Ø¨Ø·Ø§Ø·Ø³',15)">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        </div>
      </div>
    </div>

    <!-- Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª -->
    <div class="rest">
      <h2>ğŸ¥¤ Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h2>
      <div class="products">

        <!-- ÙƒÙˆÙƒØ§ÙƒÙˆÙ„Ø§ -->
        <div class="product" data-name="ÙƒÙˆÙƒØ§ÙƒÙˆÙ„Ø§" data-cat="soda"
          data-small="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/H.png"
          data-large="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/H.png"
          data-price-small="8" data-price-large="12">
          <img src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/H.png" alt="ÙƒÙˆÙƒØ§ÙƒÙˆÙ„Ø§">
          <h3>ÙƒÙˆÙƒØ§ÙƒÙˆÙ„Ø§</h3>
          <p class="price">8 Ø¯Ø±Ù‡Ù…</p>

          <div class="size-btns" data-group="size">
            <button type="button" class="active" onclick="setSize(this,'small')">ØµØºÙŠØ±</button>
            <button type="button" onclick="setSize(this,'large')">ÙƒØ¨ÙŠØ±</button>
          </div>

          <div class="size-btns" data-group="sugar">
            <button type="button" class="active" onclick="setOpt(this,'sugar','Ø¹Ø§Ø¯ÙŠ')">Ø³ÙƒØ± Ø¹Ø§Ø¯ÙŠ</button>
            <button type="button" onclick="setOpt(this,'sugar','Ø¨Ø¯ÙˆÙ†')">Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±</button>
          </div>

          <div class="size-btns" data-group="ice">
            <button type="button" class="active" onclick="setOpt(this,'ice','Ø¹Ø§Ø¯ÙŠ')">Ø«Ù„Ø¬ Ø¹Ø§Ø¯ÙŠ</button>
            <button type="button" onclick="setOpt(this,'ice','Ø¨Ø¯ÙˆÙ†')">Ø¨Ø¯ÙˆÙ† Ø«Ù„Ø¬</button>
          </div>

          <div class="qty-box">
            <button type="button" onclick="changeQty(this,-1)">âˆ’</button>
            <span>1</span>
            <button type="button" onclick="changeQty(this,1)">+</button>
          </div>

          <button type="button" onclick="addDrinkAdvanced(this)">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        </div>

      </div>
    </div>

    <!-- Ø§Ù„Ø³Ù„Ø© -->
    <div class="cart">
      <h2>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
      <div id="cartItems"></div>

      <div class="total">
        ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="total">0</span> Ø¯Ø±Ù‡Ù…
      </div>

      <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" />
      <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø«Ø§Ù„: +212600000000" oninput="validatePhone()" />
      <small id="phoneError" style="color:red;display:none;">
        Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø§Ù„Ø´ÙƒÙ„ +2126XXXXXXXX Ø£Ùˆ +2127XXXXXXXX
      </small>

      <textarea id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"></textarea>

      <button type="button" class="location" onclick="getLocation()">ğŸ“ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</button>
      <button type="button" class="whatsapp" onclick="sendWhatsApp()">ğŸ“² Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>

  </div>

  <script>
    const WHATSAPP_NUMBER = "212617139424";
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function saveCart(){ localStorage.setItem("cart", JSON.stringify(cart)); }

    function renderCart(){
      let total = 0;
      const box = document.getElementById("cartItems");
      box.innerHTML = "";

      cart.forEach((i, idx) => {
        const line = i.price * i.qty;
        total += line;

        box.innerHTML += `
          <div class="cart-item">
            <span>${escapeHtml(i.rest)} - ${escapeHtml(i.name)}</span>
            <input class="qty" type="number" min="1" step="1" value="${i.qty}"
              onchange="changeCartQty(${idx}, this.value)">
            <span>${line} Ø¯Ø±Ù‡Ù…</span>
            <button type="button" onclick="removeItem(${idx})">âœ–</button>
          </div>
        `;
      });

      document.getElementById("total").innerText = total;
    }

    function changeCartQty(idx, val){
      let v = Number(val);
      if (!Number.isFinite(v) || v < 1) v = 1;
      cart[idx].qty = v;
      saveCart();
      renderCart();
    }

    function addToCart(btn, rest, name, price){
      const card = btn.closest(".product");
      const qty = Number(card.querySelector(".qty-box span").innerText) || 1;

      const existing = cart.find(i => i.name === name && i.rest === rest && i.price === Number(price));
      if(existing) existing.qty += qty;
      else cart.push({ rest, name, price: Number(price), qty });

      saveCart();
      renderCart();
      resetQtyBox(card);
    }

    function addDrinkAdvanced(btn){
      const card = btn.closest(".product");
      const qty = Number(card.querySelector(".qty-box span").innerText) || 1;

      // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      const size = card.dataset.size || "small";
      const sugar = card.dataset.sugar || "Ø¹Ø§Ø¯ÙŠ";
      const ice = card.dataset.ice || "Ø¹Ø§Ø¯ÙŠ";
      const price = Number(card.dataset.price || card.dataset.priceSmall || 0);

      const baseName = card.dataset.name || "Ù…Ø´Ø±ÙˆØ¨";
      const fullName = `${baseName} (${size === "small" ? "ØµØºÙŠØ±" : "ÙƒØ¨ÙŠØ±"} / Ø³ÙƒØ±: ${sugar} / Ø«Ù„Ø¬: ${ice})`;

      const existing = cart.find(i => i.name === fullName && i.rest === "Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª" && i.price === price);
      if(existing) existing.qty += qty;
      else cart.push({ rest: "Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª", name: fullName, price, qty });

      saveCart();
      renderCart();
      resetQtyBox(card);
    }

    function setSize(btn, size){
      const card = btn.closest(".product");

      const priceKey = size === "small" ? "priceSmall" : "priceLarge";
      const price = Number(card.dataset[priceKey] || 0);

      card.dataset.size = size;
      card.dataset.price = price;

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø³Ø¹Ø±
      const imgUrl = card.dataset[size] || card.querySelector("img").src;
      card.querySelector("img").src = imgUrl;
      card.querySelector(".price").innerText = price + " Ø¯Ø±Ù‡Ù…";

      // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­Ø¬Ù… Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙ‚Ø·
      const group = btn.parentElement;
      group.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }

    function setOpt(btn, opt, val){
      const card = btn.closest(".product");

      // Ø®Ø²Ù†Ù‡Ø§ Ø¨Ù…ÙØ§ØªÙŠØ­ ÙˆØ§Ø¶Ø­Ø© (sugar / ice)
      card.dataset[opt] = val;

      // ØªÙØ¹ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙ‚Ø·
      const group = btn.parentElement;
      group.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }

    function changeQty(btn, step){
      const span = btn.parentElement.querySelector("span");
      let v = Number(span.innerText) + step;
      if(v < 1) v = 1;
      span.innerText = v;
    }

    function resetQtyBox(card){
      const span = card.querySelector(".qty-box span");
      if(span) span.innerText = "1";
    }

    function removeItem(idx){
      cart.splice(idx, 1);
      saveCart();
      renderCart();
    }

    function validatePhone(){
      const phoneInput = document.getElementById("phone");
      const error = document.getElementById("phoneError");
      const value = phoneInput.value.trim();

      // +2126XXXXXXXX Ø£Ùˆ +2127XXXXXXXX
      const regex = /^\+212[67]\d{8}$/;

      if(value === ""){
        error.style.display = "none";
        return true;
      }

      if(!regex.test(value)){
        error.style.display = "block";
        return false;
      }else{
        error.style.display = "none";
        return true;
      }
    }

    function sendWhatsApp(){
      if(!validatePhone()){
        alert("Ø§Ù„Ù…Ø±Ø¬Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­");
        return;
      }

      if(cart.length === 0){
        alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
        return;
      }

      const nameEl = document.getElementById("name");
      const phoneEl = document.getElementById("phone");
      const addressEl = document.getElementById("address");
      const totalEl = document.getElementById("total");

      if(nameEl.value.trim() === ""){
        alert("Ø§Ù„Ù…Ø±Ø¬Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„");
        return;
      }
      if(addressEl.value.trim() === ""){
        alert("Ø§Ù„Ù…Ø±Ø¬Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§)");
        return;
      }

      let msg = "ğŸ›’ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:\n";
      cart.forEach(i => {
        msg += `${i.rest} - ${i.name} Ã— ${i.qty} = ${i.price * i.qty} Ø¯Ø±Ù‡Ù…\n`;
      });
      msg += `\nØ§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${totalEl.innerText} Ø¯Ø±Ù‡Ù…\n`;
      msg += `Ø§Ù„Ø§Ø³Ù…: ${nameEl.value}\nØ§Ù„Ù‡Ø§ØªÙ: ${phoneEl.value}\nØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addressEl.value}`;

      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(url, "_blank");
    }

    async function getLocation(){
      if(!navigator.geolocation){
        alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
        return;
      }

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø¹Ù†ÙˆØ§Ù† Ù†ØµÙ‘ÙŠ Ù…Ù† OpenStreetMap Nominatim
        try{
          const res = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`,
            { headers: { "Accept": "application/json" } }
          );
          const data = await res.json();
          const display = data && data.display_name ? data.display_name : `Lat: ${lat}, Lng: ${lng}`;
          document.getElementById("address").value = display;
        }catch(e){
          document.getElementById("address").value = `Lat: ${lat}, Lng: ${lng}`;
        }
      }, () => {
        alert("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙƒØŒ Ø§Ù„Ù…Ø±Ø¬Ùˆ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹");
      }, { enableHighAccuracy:true, timeout:10000 });
    }

    // Ù„Ù…Ù†Ø¹ Ù…Ø´Ø§ÙƒÙ„ XSS Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù„Ø© (Ø§Ø­ØªÙŠØ§Ø·)
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª: Ø¶Ø¨Ø· Ø§Ù„Ø³Ø¹Ø±/Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
    function initDrinks(){
      document.querySelectorAll('.product[data-cat="soda"]').forEach(card => {
        // Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹: size = small
        if(!card.dataset.size) card.dataset.size = "small";
        if(!card.dataset.sugar) card.dataset.sugar = "Ø¹Ø§Ø¯ÙŠ";
        if(!card.dataset.ice) card.dataset.ice = "Ø¹Ø§Ø¯ÙŠ";

        const size = card.dataset.size;
        const price = Number(size === "small" ? card.dataset.priceSmall : card.dataset.priceLarge);
        card.dataset.price = price;
        card.querySelector(".price").innerText = price + " Ø¯Ø±Ù‡Ù…";

        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù…
        const imgUrl = card.dataset[size] || card.querySelector("img").src;
        card.querySelector("img").src = imgUrl;
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      initDrinks();
      renderCart();
    });
  </script>
</body>
</html>
